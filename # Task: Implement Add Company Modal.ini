# Task: Implement Add Company Modal

## Task ID: CMP-020-FULL

## Overview
Implement a comprehensive "Add Company" modal dialog that allows administrators to create new companies with contacts, GDS configurations (PCC + API credentials), and subscription plans.

---

## Prerequisites

Before starting, ensure these components exist:
- [ ] Modal/Dialog component (use Shadcn Dialog)
- [ ] Select component (use Shadcn Select)
- [ ] Label component (use Shadcn Label)
- [ ] Form handling setup (React Hook Form + Zod)
- [ ] Toast notifications (already implemented)

### Required Shadcn Components to Install

If not already installed, run:
```bash
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add select
npx shadcn-ui@latest add label
npx shadcn-ui@latest add radio-group
npx shadcn-ui@latest add scroll-area
```

### Required npm packages
```bash
npm install @hookform/resolvers uuid
npm install -D @types/uuid
```

---

## Component Structure

```
src/components/companies/
â”œâ”€â”€ add-company-modal.tsx        # Main modal component
â”œâ”€â”€ company-form.tsx             # Form wrapper with validation
â”œâ”€â”€ contact-form-section.tsx     # Contacts repeater section
â”œâ”€â”€ gds-config-section.tsx       # GDS configuration section
â”œâ”€â”€ pcc-tag-input.tsx            # Custom PCC tag input component
â””â”€â”€ subscription-select.tsx      # Subscription plan selector
```

---

## Detailed Requirements

### 1. Modal Container

```typescript
// Modal should:
// - Open when "Add Company" button is clicked
// - Be dismissible via X button, Escape key, or clicking outside
// - Have a maximum width of 800px
// - Be scrollable if content exceeds viewport
// - Show loading state during form submission
```

**Layout Structure:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Company                                         [X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Company Name *                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Insert company name                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  Contacts                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Person | Position | Phone | Email | WhatsApp |      â”‚   â”‚
â”‚  â”‚        |          |       |       | Telegram | Primary â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ [Contact Row 1]                              [ðŸ—‘ï¸]   â”‚   â”‚
â”‚  â”‚ [Contact Row 2]                              [ðŸ—‘ï¸]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              + Add contact                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  GDS Configuration                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [GDS Config 1 - Sabre]                       [ðŸ—‘ï¸]   â”‚   â”‚
â”‚  â”‚ [GDS Config 2 - Amadeus]                     [ðŸ—‘ï¸]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              + Add GDS                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  Subscription Plan                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Select plan...                                   â–¼  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              [Cancel]  [Create Company]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Company Name Field

```typescript
interface CompanyBasicInfo {
  name: string  // Required, min 2 chars, max 100 chars
}
```

**Validation:**
- Required field
- Minimum 2 characters
- Maximum 100 characters
- Trim whitespace

---

### 3. Contacts Section

```typescript
interface Contact {
  id: string           // Generated UUID for key prop
  person: string       // Required - contact name
  position: string     // Optional - job title
  phone: string        // Optional - phone number
  email: string        // Required - valid email format
  whatsapp: string     // Optional - WhatsApp number
  telegram: string     // Optional - Telegram handle
  isPrimary: boolean   // One contact must be primary
}
```

**UI Requirements:**
- Display as a table/grid with columns: Person, Position, Phone, Email, WhatsApp, Telegram, Primary, Actions
- Each row has a delete button (trash icon)
- "Primary" column has a radio button (only one can be selected)
- "+ Add contact" button below the table (dashed border style)
- Minimum 1 contact required
- First contact is automatically set as primary

**Validation:**
- Person name: Required, min 2 chars
- Email: Required, valid email format
- Phone: Optional, valid phone format if provided
- At least one contact must be marked as primary

---

### 4. GDS Configuration Section

```typescript
type GDSProvider = 'sabre' | 'amadeus' | 'travelport_galileo' | 'travelport_apollo' | 'travelport_worldspan'

interface GDSConfig {
  id: string              // Generated UUID for key prop
  provider: GDSProvider   // Required - dropdown selection
  homePcc: string         // Required - exactly 4 chars, uppercase alphanumeric (SINGLE INPUT, not tag)
  worksPccs: string[]     // Optional - array of PCC tags (TAG INPUT)
  credentials: {
    username: string      // Required
    password: string      // Required
  }
  thirdPartyApi: string   // Optional - dropdown for 3rd party API selection
}
```

**GDS Provider Options:**
```typescript
const gdsProviders = [
  { value: 'sabre', label: 'Sabre', description: 'Primary GDS' },
  { value: 'amadeus', label: 'Amadeus', description: '' },
  { value: 'travelport_galileo', label: 'Travelport - Galileo', description: '' },
  { value: 'travelport_apollo', label: 'Travelport - Apollo', description: '' },
  { value: 'travelport_worldspan', label: 'Travelport - Worldspan', description: '' },
]
```

**3rd Party API Options:**
```typescript
const thirdPartyApiOptions = [
  { value: '', label: 'None (Direct GDS)' },
  { value: 'travelport_uapi', label: 'Travelport Universal API' },
  { value: 'sabre_rest', label: 'Sabre REST APIs' },
  { value: 'amadeus_self_service', label: 'Amadeus Self-Service' },
  { value: 'amadeus_enterprise', label: 'Amadeus Enterprise' },
  { value: 'duffel', label: 'Duffel' },
  { value: 'kiwi', label: 'Kiwi.com' },
  { value: 'travelpayouts', label: 'Travelpayouts' },
  { value: 'custom', label: 'Custom Integration' },
]
```

**IMPORTANT - Home PCC vs Works PCCs:**
- **Home PCC**: Single regular input field (not tag input), max 4 characters, auto-uppercase
- **Works PCCs**: Tag input component allowing multiple PCC entries
```

**UI Layout for each GDS Config:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GDS                                                    [ðŸ—‘ï¸] â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ â”‚ Sabre                          â–¼  â”‚                       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                             â”‚
â”‚ PCC Configuration                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Home PCC    â”‚  â”‚ Works PCC's                          â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚ â”‚ â”‚ U9XF    â”‚ â”‚  â”‚ â”‚ L4FL â”‚xâ”‚ VV6K â”‚xâ”‚ SP9L â”‚x         â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚ API Credentials                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚ Username            â”‚  â”‚ Password            â”‚           â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚
â”‚ â”‚ â”‚                 â”‚ â”‚  â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢        â”‚ â”‚           â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                             â”‚
â”‚ USE 3rd party API                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ â”‚ Select...                      â–¼  â”‚                       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. PCC Tag Input Component (CRITICAL)

This is a custom component that needs special attention.

```typescript
interface PCCTagInputProps {
  value: string[]                    // Array of PCC codes
  onChange: (value: string[]) => void
  placeholder?: string
  maxTags?: number                   // Default: unlimited
  disabled?: boolean
}
```

**PCC Validation Rules:**
- Exactly 4 characters
- Only uppercase letters (A-Z) and digits (0-9)
- Auto-uppercase on input
- No duplicates allowed

**UI Behavior:**
1. Display existing tags as chips/badges with "x" button to remove
2. Input field at the end for adding new tags
3. On Enter or Tab or comma, validate and add tag
4. On Backspace in empty input, remove last tag
5. Visual feedback for invalid input (red border, shake animation)
6. Tags should wrap to next line (flex-wrap)

**Visual Design:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ L4FL â”‚x â”‚ VV6K â”‚x â”‚ SP9L â”‚x â”‚ Type PCC...             â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tag Chip Styling:**
- Background: `bg-secondary` (light gray)
- Border: `border border-input`
- Border radius: `rounded-md`
- Padding: `px-2 py-1`
- Font: `font-mono text-sm`
- X button: Small, appears on hover or always visible
- Size: Compact, reduced from default

**Implementation Hints:**
```typescript
// PCC validation regex
const PCC_REGEX = /^[A-Z0-9]{4}$/

// Input transformation
const formatPccInput = (input: string): string => {
  return input.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 4)
}

// Validation
const isValidPcc = (pcc: string): boolean => {
  return PCC_REGEX.test(pcc)
}
```

---

### 6. Subscription Plan Field

```typescript
type SubscriptionPlan = 'trial' | 'basic' | 'pro' | 'enterprise'

interface SubscriptionOption {
  value: SubscriptionPlan
  label: string
  description: string
  price: string
  features: string[]
}
```

**Options:**
```typescript
const subscriptionPlans: SubscriptionOption[] = [
  {
    value: 'trial',
    label: 'Trial',
    description: '14-day free trial',
    price: 'Free',
    features: ['1 user', '1 PCC', 'Basic support']
  },
  {
    value: 'basic',
    label: 'Basic',
    description: 'For small agencies',
    price: '$99/mo',
    features: ['5 users', '2 PCCs', 'Email support']
  },
  {
    value: 'pro',
    label: 'Pro',
    description: 'For growing agencies',
    price: '$299/mo',
    features: ['15 users', '5 PCCs', 'Priority support', 'Price Tracker']
  },
  {
    value: 'enterprise',
    label: 'Enterprise',
    description: 'For large agencies',
    price: 'Custom',
    features: ['Unlimited users', 'Unlimited PCCs', '24/7 support', 'All tools', 'Custom integrations']
  },
]
```

**UI Options:**

**Option A: Simple Dropdown**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pro - $299/mo                      â–¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Option B: Radio Card Selection (Recommended)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—‹ Trial         â”‚ â”‚ â—‹ Basic         â”‚
â”‚   Free          â”‚ â”‚   $99/mo        â”‚
â”‚   14-day trial  â”‚ â”‚   5 users       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â— Pro           â”‚ â”‚ â—‹ Enterprise    â”‚
â”‚   $299/mo       â”‚ â”‚   Custom        â”‚
â”‚   15 users      â”‚ â”‚   Unlimited     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7. Form Validation Schema (Zod)

```typescript
import { z } from 'zod'

const contactSchema = z.object({
  id: z.string(),
  person: z.string().min(2, 'Name must be at least 2 characters'),
  position: z.string().optional(),
  phone: z.string().optional(),
  email: z.string().email('Invalid email address'),
  whatsapp: z.string().optional(),
  telegram: z.string().optional(),
  isPrimary: z.boolean(),
})

const gdsConfigSchema = z.object({
  id: z.string(),
  provider: z.enum(['sabre', 'amadeus', 'travelport_galileo', 'travelport_apollo', 'travelport_worldspan']),
  homePcc: z.string()
    .length(4, 'PCC must be exactly 4 characters')
    .regex(/^[A-Z0-9]{4}$/, 'PCC must contain only uppercase letters and numbers'),
  worksPccs: z.array(
    z.string()
      .length(4, 'PCC must be exactly 4 characters')
      .regex(/^[A-Z0-9]{4}$/, 'Invalid PCC format')
  ),
  credentials: z.object({
    username: z.string().min(1, 'Username is required'),
    password: z.string().min(1, 'Password is required'),
  }),
  thirdPartyApi: z.string().optional(),
})

const createCompanySchema = z.object({
  name: z.string()
    .min(2, 'Company name must be at least 2 characters')
    .max(100, 'Company name must be less than 100 characters'),
  contacts: z.array(contactSchema)
    .min(1, 'At least one contact is required')
    .refine(
      (contacts) => contacts.some(c => c.isPrimary),
      'One contact must be marked as primary'
    ),
  gdsConfigs: z.array(gdsConfigSchema)
    .min(1, 'At least one GDS configuration is required'),
  subscription: z.enum(['trial', 'basic', 'pro', 'enterprise']),
})

type CreateCompanyInput = z.infer<typeof createCompanySchema>
```

---

### 8. GraphQL Mutation

```graphql
mutation CreateCompany($input: CreateCompanyInput!) {
  createCompany(input: $input) {
    id
    name
    status
    subscription
    contacts {
      id
      person
      email
      isPrimary
    }
    gdsConfigs {
      id
      provider
      homePcc
      worksPccs
    }
    createdAt
  }
}
```

---

### 9. State Management

```typescript
// Use React Hook Form for form state
const form = useForm<CreateCompanyInput>({
  resolver: zodResolver(createCompanySchema),
  defaultValues: {
    name: '',
    contacts: [
      {
        id: generateId(),
        person: '',
        position: '',
        phone: '',
        email: '',
        whatsapp: '',
        telegram: '',
        isPrimary: true,
      }
    ],
    gdsConfigs: [
      {
        id: generateId(),
        provider: 'sabre',
        homePcc: '',
        worksPccs: [],
        credentials: {
          username: '',
          password: '',
        },
        thirdPartyApi: '',
      }
    ],
    subscription: 'trial',
  },
})

// Use useFieldArray for dynamic sections
const { fields: contactFields, append: addContact, remove: removeContact } = useFieldArray({
  control: form.control,
  name: 'contacts',
})

const { fields: gdsFields, append: addGds, remove: removeGds } = useFieldArray({
  control: form.control,
  name: 'gdsConfigs',
})
```

---

### 10. Error Handling

```typescript
// Display field-level errors below each input
// Display form-level errors at the top of the form
// Show toast on submission error
// Disable submit button while submitting
// Show loading spinner on submit button while submitting
```

---

### 11. Success Flow

1. On successful submission:
   - Close modal
   - Show success toast: "Company created successfully"
   - Refresh companies list (invalidate GraphQL cache)
   - Navigate to new company detail page (optional)

---

## Files to Create/Modify

### New Files:
1. `src/components/companies/add-company-modal.tsx`
2. `src/components/companies/contact-form-section.tsx`
3. `src/components/companies/gds-config-section.tsx`
4. `src/components/ui/pcc-tag-input.tsx`
5. `src/components/companies/subscription-select.tsx`
6. `src/lib/validations/company.ts` (Zod schemas)

### Modify:
1. `src/app/companies/page.tsx` - Add modal trigger
2. `src/lib/api/graphql/queries.ts` - Add mutation

---

## Acceptance Criteria

- [ ] Modal opens when clicking "Add Company" button
- [ ] Company name field validates correctly
- [ ] Can add/remove multiple contacts
- [ ] Primary contact radio works correctly
- [ ] Can add/remove multiple GDS configurations
- [ ] GDS dropdown shows all provider options
- [ ] Home PCC field accepts only valid format (4 chars, uppercase alphanumeric)
- [ ] Works PCCs tag input works correctly:
  - [ ] Auto-uppercase
  - [ ] Max 4 characters per tag
  - [ ] Tags display as chips with X to remove
  - [ ] Enter/Tab/Comma adds tag
  - [ ] Backspace removes last tag
  - [ ] No duplicate tags
  - [ ] Flex-wrap for multiple tags
- [ ] API credentials fields work (password masked)
- [ ] 3rd party API dropdown works
- [ ] Subscription plan selection works
- [ ] Form validation prevents invalid submission
- [ ] Loading state shows during submission
- [ ] Success toast appears after creation
- [ ] Modal closes on success
- [ ] Companies list refreshes after creation

---

## Testing Checklist

- [ ] Create company with minimum required fields
- [ ] Create company with multiple contacts
- [ ] Create company with multiple GDS configs
- [ ] Verify PCC validation (invalid chars, wrong length)
- [ ] Verify email validation
- [ ] Try to submit without required fields
- [ ] Verify primary contact enforcement
- [ ] Test keyboard navigation
- [ ] Test on mobile viewport
- [ ] Test with slow network (loading states)

---

## Estimated Time

- PCC Tag Input Component: 2-3 hours
- Contact Form Section: 1-2 hours
- GDS Config Section: 2-3 hours
- Subscription Select: 1 hour
- Main Modal + Form Integration: 2-3 hours
- Validation + Error Handling: 1-2 hours
- GraphQL Integration: 1 hour
- Testing + Polish: 2 hours

**Total: 12-17 hours**

---

## Reference Images

The user has provided mockups showing:
1. GDS API Credentials layout with Username/Password fields and 3rd party API dropdown
2. PCC tag input with reduced-size tags that expand flexibly

Follow these visual references for implementation.

---

## Required Imports

### add-company-modal.tsx
```typescript
import React, { useState } from 'react'
import { useForm, useFieldArray } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { v4 as uuidv4 } from 'uuid'
import { Plus, Trash2, X, Loader2 } from 'lucide-react'
import { useMutation } from '@apollo/client'

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { ScrollArea } from '@/components/ui/scroll-area'
import { Separator } from '@/components/ui/separator'
import { useToast } from '@/lib/hooks/use-toast'

import { ContactFormSection } from './contact-form-section'
import { GdsConfigSection } from './gds-config-section'
import { SubscriptionSelect } from './subscription-select'
import { createCompanySchema, type CreateCompanyInput } from '@/lib/validations/company'
import { CREATE_COMPANY } from '@/lib/api/graphql/queries'
```

### pcc-tag-input.tsx
```typescript
import React, { useState, useRef, KeyboardEvent, useEffect } from 'react'
import { X } from 'lucide-react'
import { cn } from '@/lib/utils'
```

---

## Example Component Skeleton

### pcc-tag-input.tsx (starter code)
```typescript
import React, { useState, useRef, KeyboardEvent } from 'react'
import { X } from 'lucide-react'
import { cn } from '@/lib/utils'

interface PCCTagInputProps {
  value: string[]
  onChange: (value: string[]) => void
  placeholder?: string
  disabled?: boolean
  error?: boolean
}

const PCC_REGEX = /^[A-Z0-9]{4}$/

export function PCCTagInput({
  value = [],
  onChange,
  placeholder = 'Type PCC...',
  disabled = false,
  error = false,
}: PCCTagInputProps) {
  const [inputValue, setInputValue] = useState('')
  const [isInvalid, setIsInvalid] = useState(false)
  const inputRef = useRef<HTMLInputElement>(null)

  const formatInput = (input: string): string => {
    return input.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 4)
  }

  const addTag = () => {
    const formatted = formatInput(inputValue)
    if (PCC_REGEX.test(formatted) && !value.includes(formatted)) {
      onChange([...value, formatted])
      setInputValue('')
      setIsInvalid(false)
    } else if (inputValue.length > 0) {
      setIsInvalid(true)
      // Shake animation - remove after 500ms
      setTimeout(() => setIsInvalid(false), 500)
    }
  }

  const removeTag = (index: number) => {
    onChange(value.filter((_, i) => i !== index))
  }

  const handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {
    if (e.key === 'Enter' || e.key === 'Tab' || e.key === ',') {
      e.preventDefault()
      addTag()
    } else if (e.key === 'Backspace' && inputValue === '' && value.length > 0) {
      removeTag(value.length - 1)
    }
  }

  return (
    <div
      className={cn(
        'flex flex-wrap items-center gap-1.5 rounded-lg border bg-background px-3 py-2 min-h-[40px]',
        error || isInvalid ? 'border-destructive' : 'border-input',
        isInvalid && 'animate-shake',
        disabled && 'opacity-50 cursor-not-allowed'
      )}
      onClick={() => inputRef.current?.focus()}
    >
      {value.map((tag, index) => (
        <span
          key={tag}
          className="inline-flex items-center gap-1 rounded bg-secondary px-2 py-0.5 text-sm font-mono"
        >
          {tag}
          {!disabled && (
            <button
              type="button"
              onClick={(e) => {
                e.stopPropagation()
                removeTag(index)
              }}
              className="text-muted-foreground hover:text-foreground"
            >
              <X className="h-3 w-3" />
            </button>
          )}
        </span>
      ))}
      <input
        ref={inputRef}
        type="text"
        value={inputValue}
        onChange={(e) => setInputValue(formatInput(e.target.value))}
        onKeyDown={handleKeyDown}
        onBlur={addTag}
        placeholder={value.length === 0 ? placeholder : ''}
        disabled={disabled}
        className="flex-1 min-w-[80px] bg-transparent outline-none text-sm font-mono placeholder:text-muted-foreground"
      />
    </div>
  )
}
```

Add this to your CSS for shake animation:
```css
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}

.animate-shake {
  animation: shake 0.3s ease-in-out;
}
```
